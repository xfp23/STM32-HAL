# STM32 HAL库开发指南
**本频道只提供idf编程方法，不提供知识点注解**

# 版权信息

© 2024 . 未经许可不得复制、修改或分发。 此文献为 [小風的藏書閣](https://t.me/xfp2333) 所有。

# STM32 Timer 知识扩展

# 定时器的定时周期可以通过以下公式计算：

### 计算公式：

$$T = \frac{(ARR + 1) \times (PSC + 1)}{f_{TIM}}$$

其中：
- \( T \) ：定时器定时周期（单位：秒）
- \( ARR \) ：自动重载寄存器的值（自动重载值）
- \( PSC \) ：预分频器的值
- $f_{TIM}$ ：定时器时钟频率，通常是 APB 时钟频率（单位：赫兹）

### 计算步骤：
1. **选择时钟频率**：
   - 定时器时钟频率 $$\( f_{TIM} \) 通常是由 APB 时钟决定（对于 STM32，APB1 或 APB2 时钟）。
   - 如果没有外部时钟源，时钟频率通常由系统时钟源（比如 HCLK）分配给 APB 总线，然后作为定时器时钟源。

2. **设置预分频器 \( PSC \)**：
   - 预分频器将定时器时钟频率降低。通过设置 \( PSC \) 的值，来调整定时器的频率。公式为：

$$
f_{TIM} = \frac{f_{APB}}{(PSC + 1)}
$$

   其中  $$\( f_{APB} \)$$  是 APB 总线的时钟频率。

3. **设置自动重载值 \( ARR \)**：
   - 自动重载值决定了定时器计数到多少时会溢出并重新计数。通常，ARR 会设置为定时周期所需的计数值。

4. **定时周期计算**：
   - 定时器定时时间 \( T \) 即为计数器从 0 到 ARR（即计数 \( ARR + 1 \) 个时钟周期）所需的时间。

### 示例：
假设系统时钟（HCLK）为 72 MHz，APB1 时钟为 36 MHz，定时器时钟为 APB1 时钟。现在我们想要定时器的定时周期为 1 毫秒。

#### 1. 设置预分频器：
假设我们选择预分频器值 \( PSC = 35 \)，那么定时器的时钟频率为：

$$\[
f_{TIM} = \frac{36,000,000}{PSC + 1} = \frac{36,000,000}{36} = 1,000,000 \, \text{Hz}
\]
$$


#### 2. 设置自动重载值：
定时周期 

$$
\( T = 1 \, \text{ms} = 0.001 \, \text{seconds} \)
$$

，则需要的计数器值为：
$$\[
ARR = \frac{T \times f_{TIM}}{1} - 1 = \frac{0.001 \times 1,000,000}{1} - 1 = 999
\]
$$

因此，定时器的自动重载寄存器 \( ARR \) 设置为 999，预分频器 \( PSC \) 设置为 35，这样定时器的定时周期为 1 毫秒。

### 总结：
- 定时器时钟频率  $$\( f_{TIM} \)$$  是由预分频器  $$\( PSC \)$$  决定的。
- 自动重载寄存器  $$\( ARR \)$$  决定了定时器的定时周期。
- 通过调整  $$\( PSC \)$$  和  $$\( ARR \)$$  的值，可以精确控制定时器的定时精度。
